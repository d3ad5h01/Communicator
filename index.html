<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0">
    <title>Main App</title>
    <link rel="stylesheet"
          type="text/css"
          href="./style.css">
</head>

<body>
    <div class="flexRow centerRow">
        <div class="flexCol maxWidth200 centerCol centerRow">
            <div id="messages">
                <h3>Messages</h3>
            </div>
            </br>
            <form>
                <textarea name="myText"
                          id="message-area"
                          rows="1"
                          placeholder="Type Message here..."
                          maxlength="400"></textarea>
            </form>
            </br>
            <button id="send-message"
                    class="button-6 backgroundWhite">Send to Child</button>
            </br>
            <textarea name="myText"
                      id="number-area"
                      rows="1"
                      placeholder="Number to call.."
                      maxlength="400"></textarea>
            </br>
            <button id="dial-button"
                    class="button-6 backgroundGreen">DIAL</button>
        </div>
    </div>


    <script>

        let dialer_win;
        let communication = [];


        const b1 = document.getElementById("dial-button");

        //On click of dial button , opening popup and adding dialed number in its dial-input
        b1.onclick = () => {
            dialer_win = open('./dialer/popup.html', 'popup',
                "left=100, top=100, width=426px, height=653px");
            setTimeout(() => {
                dialer_win.document.getElementById('dialpad-input').value = document.getElementById('number-area').value;
            }, 500);
        };


        /*
            Send Message

            dialer_win is address of popup window
            We can access its function so,

            we access its recieveMessage function and use it to share message.

        */
        function sendMessage(message) {
            // sending to tab
            dialer_win.recieveMessage(message);

            // local updating
            console.log('Parent:' + message);
            communication.push("Parent#" + message);
            document.getElementById('messages').innerHTML += `Parent: ${message} </br>`;
        }


        /*
            recieve message 

            If we get "ended" => This means call ended so close popup window
            
        */
        function recieveMessage(message) {
            if (message == 'ended')
                dialer_win.close();

            // local  updating
            console.log('Dialer:' + message);
            communication.push("Dialer#" + message);
            document.getElementById('messages').innerHTML += `Dialer: ${message} </br>`;

        }


        //Send message button handeling
        document.getElementById('send-message').addEventListener('click', () => {
            sendMessage(document.getElementById('message-area').value);
            document.getElementById('message-area').value = '';
        })


        // Irrelevent style handeling logic
        const txt = document.querySelector('#message-area');
        function setNewSize() {
            this.style.height = "1px";
            this.style.height = this.scrollHeight + "px";
        }
        txt.addEventListener('keyup', setNewSize);


    </script>
</body>

</html>